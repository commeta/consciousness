# Валидация ЭИРО и метрики Φₑ

**Цель:** эмпирически проверить, что метрика

$$
\Phi_e = \int_{t_0}^{t_1} I(t)\,\times\,R(t)\,dt
$$

на основе компонент интеграции $I(t)$ и рекуррентности $R(t)$ надёжно различает состояния «сознательное» (бодрствование) и «бессознательное» (глубокая анестезия) в данных ЭЭГ.

---

## Шаг 1. Подготовка среды

1. Создать виртуальное окружение Python (например, `conda create -n eiro python=3.10`).
2. Установить ключевые библиотеки:

   ```
   pip install mne numpy scipy scikit-learn matplotlib pandas
   ```

---

## Шаг 2. Выбор и загрузка данных

1. **Найти репозиторий GitHub** с EDF-файлами Propofol/Sevoflurane EEG.
2. Склонировать или скачать репозиторий, например:

   ```
   git clone https://github.com/your/repo-anesthesia-eeg.git data/anesthesia
   ```
3. Организовать структуру папок:

   ```
   data/anesthesia/
     sub-01/
       ses-01_baseline.edf
       ses-02_anesthesia.edf
       ses-03_recovery.edf
     sub-02/
       …
   ```

---

## Шаг 3. Предобработка сигналов

1. **Загрузка EDF**

   ```python
   import mne
   raw = mne.io.read_raw_edf('data/anesthesia/sub-01/ses-01_baseline.edf', preload=True)
   ```

2. **Фильтрация**

   ```python
   raw.filter(l_freq=1., h_freq=100.)
   raw.notch_filter(freqs=[50])
   ```

3. **ICA-коррекция артефактов**

   ```python
   ica = mne.preprocessing.ICA(n_components=20, random_state=0)
   ica.fit(raw)
   ica.exclude = [ica_components_from_eog]  # определить компоненты по EOG
   raw = ica.apply(raw)
   ```

4. **Разметка эпизодов**

   * Создать аннотации или события для трёх состояний:

     * `baseline` (до индукции)
     * `anesthesia` (глубокая анестезия)
     * `recovery` (выход из анестезии)
   * Например, каждая сессия в отдельном файле соответствует одному состоянию.

---

## Шаг 4. Расчёт компонент $I(t)$ и $R(t)$

### 4.1 Параметры окон

* Длина окна $\Delta t = 0.1$ с
* Перекрытие 50 % → шаг 0.05 с

### 4.2 Расчёт $I(t)$

Для каждого окна:

1. Извлечь массив формы (n\_channels × n\_times).
2. Оценить энтропию каждого канала $H_i$ (метод k-NN или биннинг).
3. Оценить совместную энтропию всех каналов $H_{\rm joint}$.
4. $I(t) = \sum_i H_i \;-\; H_{\rm joint}.$

### 4.3 Расчёт $R(t)$

Для того же окна:

1. Построить матрицу корреляций или PLV (n\_channels × n\_channels).
2. Нанести на спекторную модель:

   * **Спектральный радиус**: максимальное собственное значение матрицы.
   * **Или** сумма абсолютных внедиагональных корреляций, нормированная.
3. $$
   R(t) = \text{spectral\_radius}(C) \quad\text{или}\quad \frac{\sum_{i\neq j} |c_{ij}|}{N(N-1)}.
   $$

---

## Шаг 5. Интеграция во времени

1. Собрать векторы $\{I(t_k)\}$ и $\{R(t_k)\}$ для всех окон $k = 1..K$.
2. Вычислить

   $\Phi_e = \sum_{k=1}^K I(t_k)\,\times\,R(t_k)\,\Delta t.$
3. Повторить для каждого эпизода (baseline, anesthesia, recovery) у каждого субъекта.

---

## Шаг 6. Статистическая верификация

1. **Собрать таблицу**: строки — эпизоды, колонки — subject, condition, $\Phi_e$.

2. **ROC-анализ**:

   ```python
   from sklearn.metrics import roc_curve, auc
   fpr, tpr, _ = roc_curve(y_true, phi_e_values)
   roc_auc = auc(fpr, tpr)
   ```

   – цель: AUC > 0.8 свидетельствует о хорошей разделяющей способности.

3. **Статистические тесты**

   * Парный t-тест между baseline vs anesthesia и anesthesia vs recovery:

     ```python
     from scipy.stats import ttest_rel
     ttest_rel(phi_baseline, phi_anesthesia)
     ```
   * При необходимости U-тест (непараметрический).

4. **Кросс-валидация**

   * Создать классификатор (логистическая регрессия) на $\Phi_e$, оценить accuracy на отложенной части данных.

---

## Шаг 7. Визуализация и отчёт

1. **Графики по субъектам**:

   * $I(t)$ и $R(t)$ во времени для примера.
   * Barplot средних $\Phi_e$ по состояниям.
2. **ROC-кривая** с AUC.
3. **Код и результаты**

   * Собрать Jupyter Notebook с полным workflow.
   * Опубликовать в GitHub с инструкцией по воспроизведению (`README.md`).

---

### Результат

Этот детализированный план позволит вам **полностью реализовать и валидировать** метрику Φₑ и рамки ЭИРО на реальных данных ЭЭГ при анестезии, оценив её способность различать сознание и бессознание.

---


## Исчерпывающая валидация

Для того чтобы план стал максимально полным и готовым к исполнению, рекомендую добавить следующие разделы и уточнения:


### 1. Контроль качества данных и артефактов

– **Метрики SNR** на исходных эпизодах (baseline vs anesthesia) и после предобработки.   
– Автоматизированная отчётность по удалённым ICA-компонентам (сколько, каких типов).   
– Визуальная проверка нескольких «случайных» сегментов после очистки.   

---

### 2. Псевдо-контроль (суррогатные тесты)

– **Перемешивание** временных окон: посчитать Φₑ на «shuffled» данных, показать, что разделение исчезает.   
– **Сравнение с «нулевой» моделью**: e.g. вычислить Φₑ на белом шуме с тем же спектром.  

---

### 3. Чувствительность к параметрам

– Повторить расчёт Φₑ для других размеров окон (0.05 с, 0.2 с) и степеней перекрытия (25 %, 75 %), убедиться, что выводы устойчивы.  
– Проверить разные методы оценки энтропии (биннинг vs k-NN) и рекуррентности (спектральный радиус vs сумма корреляций).  

---

### 4. Оценка эффекта субъекта

– **Mixed-effects модель:** учесть вариабельность между субъектами при оценке статистики.  
– Показать, что эффект состояния (baseline vs anesthesia) значим даже при контроле по субъектам.  

---

### 5. Открытость и воспроизводимость

– Указать точные версии библиотек (requirements.txt).  
– Ссылку на скрипт автоматической загрузки данных из GitHub.  
– Линк на Zenodo/GitHub с готовым Docker-образом или Binder-окружением для «one-click» воспроизведения.  

---

### 6. Этическая декларация

– Уточнить, что данные анонимизированы и используются согласно лицензии репозитория.  
– Дать ссылку на IRB/этическое одобрение, если оно есть.  

---

#### Итог

Добавив эти блоки, вы обеспечите:

* **Качество** и **надежность** получаемых результатов;
* **Контроль за возможными артефактами** и **сюрпризами**;
* **Устойчивость** выводов к выбору параметров;
* **Прозрачность** и **воспроизводимость** для читателей и рецензентов.


---


Оглавление:

- [Теория Динамической Интеграции Сознания](/Theory-Of-Dynamic-Integration-Of-Consciousness/README.md)

