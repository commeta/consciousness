# Валидация метрик ТДИС (Φ, D, T и КШДИС)

**Цель:** оценить, насколько классические метрики ТДИС — интеграция (Φ), дифференциация (D), темпоральная когерентность (T) — и их линейная комбинация (КШДИС) различают уровни сознания в двух сценариях: фазы сна vs бодрствование и пациенты с расстройствами сознания.

[Эмпирическая формализация ТДИС: Методы измерения и математические модели](/Theory-Of-Dynamic-Integration-Of-Consciousness/Empirical-formalization.md)

---

## Шаг 1. Выбор и загрузка данных

1. **Sleep-EDF**

   * Источник: PhysioNet Sleep-EDF Database.
   * Файлы: полисомнография (EEG, EOG, EMG) с разметкой стадий W, N1, N2, N3, REM.
   * Скачайте файлы EDF и файлы аннотаций hypnogram.

2. **DOC-EEG** (Disorders of Consciousness)

   * Источник: открытые клинические датасеты с EEG пациентов в вегетативном (VS) и минимальном сознании (MCS).
   * При наличии: EDF-файлы + метки состояния для каждого пациента.

---

## Шаг 2. Предобработка сигналов

1. **Загрузка** (MNE-Python):

   ```python
   raw = mne.io.read_raw_edf(filepath, preload=True)
   ```

2. **Фильтрация**

   ```python
   raw.filter(l_freq=0.5, h_freq=40)  # для сна; для DOC — 1–100 Гц
   raw.notch_filter(freqs=[50, 100])
   ```

3. **Артефакт-коррекция**

   * ICA или ручное удаление сегментов с шумом/артефактами.

4. **Разметка**

   * **Sleep-EDF**: использовать hypnogram для нарезки сигналов по стадиям сна.
   * **DOC-EEG**: разбить запись на отрезки (например, 30 с) и присвоить метку VS или MCS.

---

## Шаг 3. Расчёт метрик

### 3.1 Интеграция (Φ)

1. **Параметры**: взять окна 30 с без перекрытия (как стандарт для сна) или адаптировать.
2. **Энтропия каналов**

   * Оценить $H_i$ для каждого канала (биннинг / k-NN).
3. **Совместная энтропия**

   * Оценить $H_{\rm joint}$ для всех каналов.
4. **Φ**

   $Φ = \sum_i H_i \;-\; H_{\rm joint}.$

### 3.2 Дифференциация (D)

1. **Подход 1:** измерить **спектральное разнообразие**

   $D = -\sum_f P(f)\ln P(f),$

   где $P(f)$ — нормированная спектральная плотность (PSD) окна.

2. **Подход 2:** **энтропия состояний**

   * Кластеризовать фичи окна (напр. спектральные биты) и взять энтропию распределения кластеров.

### 3.3 Темпоральная когерентность (T)

1. **Автокорреляция LFP**

   * Рассчитать автокорреляционную функцию канала (или средней сигнала) и взять её время спада до $1/e$.

2. **Длина когерентного окна**

   * Измерить, на сколько секунд сохраняется высокая когерентность (например, PLV > 0.8) между важными каналами.

---

## Шаг 4. Комплексная шкала КШДИС

1. **Составление**

   $\mathrm{КШДИС} = α\,Φ + β\,D + γ\,T.$
2. **Калибровка весов**

   * Объединить данные всех субъектов и эпизодов.
   * Использовать ROC-оптимизацию (максимум AUC) для поиска оптимальных $α,β,γ$.
   * Ограничение: $α+β+γ=1$ (или без ограничения, но нормализовать потом).

---

## Шаг 5. Валидация

1. **ROC-анализ по каждой метрике**

   * Отдельно для Φ, D, T и для КШДИС.
   * Вычислить AUC, сравнить между метриками.

2. **Статистические тесты**

   * Для Sleep-EDF: сравнить метрики между «бодрствование» vs «N2+N3» или «W vs REM» (paired t-test / Wilcoxon).
   * Для DOC-EEG: сравнить между VS vs MCS (independent t-test / Mann–Whitney).

3. **Кросс-валидация шкалы КШДИС**

   * Разбить субъектов на train/test.
   * На train подобрать $α,β,γ$; на test оценить разделяющую способность.

---

## Шаг 6. Визуализация и отчёт

1. **Графики**

   * Boxplots Φ, D, T, КШДИС по состояниям.
   * ROC-кривые всех четырёх метрик на одном графике.

2. **Таблицы**

   * AUC и 95% CI для каждой метрики.
   * p-значения статистических тестов.

3. **Отчёт**

   * Подготовить Jupyter-notebook с описанием, кодом и результатами.
   * Опубликовать в открытом репозитории с инструкциями для воспроизведения (`README.md`).

---

Такой детализированный план позволит всесторонне оценить классические параметры ТДИС и их комбинацию, показать их диагностическую ценность и сравнить между собой.

---

## Исчерпывающая валидация

Чтобы сделать план максимально исчерпывающим и готовым к практической реализации, рекомендую добавить следующие блоки:


### 1. Контроль качества данных

* **Метрики SNR и артефакты:** рассчитать отношение сигнал/шум до и после предобработки, чтобы отсеять «плохие» сегменты или целиком «плохих» субъектов.
* **Отчёт об удалённых компонентах ICA:** сколько и каких (EOG, EMG и пр.), чтобы можно было оценить влияние очистки на данные.

### 2. Суррогатные тесты

* **Перемешанные данные:** вычислить Φ, D, T и КШДИС на временно «shuffled» ЭЭГ, чтобы убедиться, что разделение исчезает.
* **Нулевой шум:** применить те же процедуры к симулированному шуму с тем же PSD-спектром.

### 3. Анализ чувствительности

* **Размер окна и перекрытие:** повторить расчёты для Δt = 10, 20, 60 с и перекрытия 25 %, 75 %—проверить устойчивость результатов.
* **Методы энтропии:** сравнить биннинг vs k-NN для расчёта Hᵢ и Hⱼₒᵢₙₜ.
* **Методы рекуррентности:** спектральный радиус vs сумма корреляций vs spectral clustering.

### 4. Параметрическая и непараметрическая статистика

* **Multiple comparison:** скорректировать p-значения (FDR или Bonferroni) при множественных тестах по каналам, состояниям и метрикам.
* **Effect size:** оценить Cohen’s d или Cliff’s delta для всех сравнений.

### 5. Учет вариабельности между субъектами

* **Mixed-effects модель** (например, через `statsmodels`): включить случайный фактор «субъект» и фиксированные эффекты «состояние» и «метрика».
* **Индивидуальные траектории:** показать разброс по людям, чтобы не терять вариативность «на уровне субъекта».

### 6. Документация и воспроизводимость

* **requirements.txt** или `environment.yml` с точными версиями библиотек.
* **Dockerfile** или Binder-конфигурация, чтобы любой мог запустить анализ «в один клик».
* **Ссылка на полный код** и инструкции в `README.md`.

### 7. Этические и демографические данные

* **Описание когорты:** пол, возраст, дозы пропофола/севофлурана, продолжительность записи.
* **Лицензия и этика:** указать условия использования репозитория с данными, получение одобрения IRB (если требуется).

---

Добавив эти разделы, вы не только укрепите **валидность** получаемых выводов, но и обеспечите **надежность**, **робастность** и **воспроизводимость** всего исследования.


---

Оглавление:

- [Теория Динамической Интеграции Сознания](/Theory-Of-Dynamic-Integration-Of-Consciousness/README.md)
